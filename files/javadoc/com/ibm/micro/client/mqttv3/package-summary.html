<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc (version 1.7.0 - Jan 2014) on Thu Apr 17 11:23:21 BST 2014 -->
<title>com.ibm.micro.client.mqttv3 (MQTT v3 Client API)</title>
<meta name="date" content="2014-04-17">
<link rel="stylesheet" type="text/css" href="../../../../../stylesheet.css" title="Style">
</head>
<body>
<script type="text/javascript"><!--
    if (location.href.indexOf('is-external=true') == -1) {
        parent.document.title="com.ibm.micro.client.mqttv3 (MQTT v3 Client API)";
    }
//-->
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div role="navigation" title ="TOP_Navigation" aria-label ="Top Navigation Bar"/>
<div class="topNav"><a name="navbar_top">
<!--   -->
</a>
<div class="skip"><a href="#skip-navbar_top" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar_top_firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../overview-summary.html">Overview</a></li>
<li class="navBarCell1Rev">Package</li>
<li>Class</li>
<li><a href="package-use.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li>Prev Package</li>
<li><a href="../../../../../org/eclipse/paho/client/mqttv3/package-summary.html">Next Package</a></li>
</ul>
<ul class="navList">
<li><a href="../../../../../index.html?com/ibm/micro/client/mqttv3/package-summary.html" target="_top">Frames</a></li>
<li><a href="package-summary.html" target="_top">No Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../../../allclasses-noframe.html">All Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<a name="skip-navbar_top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<div role="main" title ="com.ibm.micro.client.mqttv3" aria-labelledby ="Header1"/>
<div class="header">
<h1 title="Package" class="title" id="Header1">Package&nbsp;com.ibm.micro.client.mqttv3</h1>
<div class="docSummary">
<div class="block">Contains a programming interface for communicating with an MQTT server using the MQTT V3 
protocol utilising the Eclipse MQTT client implementation.</div>
</div>
<p>See:&nbsp;<a href="#package_description">Description</a></p>
</div>
<div class="contentContainer">
<ul class="blockList">
<li class="blockList">
<table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Interface Summary table, listing interfaces, and an explanation">
<caption><span>Interface Summary</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Interface</th>
<th class="colLast" scope="col">Description</th>
</tr>
<tbody>
<tr class="altColor">
<td class="colFirst"><a href="../../../../../com/ibm/micro/client/mqttv3/MqttCallback.html" title="interface in com.ibm.micro.client.mqttv3">MqttCallback</a></td>
<td class="colLast">
<div class="block">Asynchronous message listener.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><a href="../../../../../com/ibm/micro/client/mqttv3/MqttClientPersistence.html" title="interface in com.ibm.micro.client.mqttv3">MqttClientPersistence</a></td>
<td class="colLast">
<div class="block">Represents a persistent data store, used to store outbound and inbound
 messages, in order to achieve reliable messaging.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><a href="../../../../../com/ibm/micro/client/mqttv3/MqttDeliveryToken.html" title="interface in com.ibm.micro.client.mqttv3">MqttDeliveryToken</a></td>
<td class="colLast">
<div class="block">Provides a mechanism for tracking the delivery of messages.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><a href="../../../../../com/ibm/micro/client/mqttv3/MqttPersistable.html" title="interface in com.ibm.micro.client.mqttv3">MqttPersistable</a></td>
<td class="colLast">
<div class="block">Represents an object used to pass data to be persisted across the
 <a href="../../../../../com/ibm/micro/client/mqttv3/MqttClientPersistence.html" title="interface in com.ibm.micro.client.mqttv3"><code>MqttClientPersistence</code></a>
 interface.</div>
</td>
</tr>
</tbody>
</table>
</li>
<li class="blockList">
<table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Class Summary table, listing classes, and an explanation">
<caption><span>Class Summary</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Class</th>
<th class="colLast" scope="col">Description</th>
</tr>
<tbody>
<tr class="altColor">
<td class="colFirst"><a href="../../../../../com/ibm/micro/client/mqttv3/MqttClient.html" title="class in com.ibm.micro.client.mqttv3">MqttClient</a></td>
<td class="colLast">
<div class="block">Lightweight client for talking to an MQTT server via the MQTT version 3 
 protocol.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><a href="../../../../../com/ibm/micro/client/mqttv3/MqttConnectOptions.html" title="class in com.ibm.micro.client.mqttv3">MqttConnectOptions</a></td>
<td class="colLast">
<div class="block">Stores options used when connecting to a server.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><a href="../../../../../com/ibm/micro/client/mqttv3/MqttDefaultFilePersistence.html" title="class in com.ibm.micro.client.mqttv3">MqttDefaultFilePersistence</a></td>
<td class="colLast">
<div class="block">An implementation of the <a href="../../../../../com/ibm/micro/client/mqttv3/MqttClientPersistence.html" title="interface in com.ibm.micro.client.mqttv3"><code>MqttClientPersistence</code></a> interface that provides
 file based persistence.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><a href="../../../../../com/ibm/micro/client/mqttv3/MqttMessage.html" title="class in com.ibm.micro.client.mqttv3">MqttMessage</a></td>
<td class="colLast">
<div class="block">An MQTT message.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><a href="../../../../../com/ibm/micro/client/mqttv3/MqttTopic.html" title="class in com.ibm.micro.client.mqttv3">MqttTopic</a></td>
<td class="colLast">
<div class="block">Represents a topic destination, used for publish/subscribe messaging.</div>
</td>
</tr>
</tbody>
</table>
</li>
<li class="blockList">
<table class="packageSummary" border="0" cellpadding="3" cellspacing="0" summary="Exception Summary table, listing exceptions, and an explanation">
<caption><span>Exception Summary</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Exception</th>
<th class="colLast" scope="col">Description</th>
</tr>
<tbody>
<tr class="altColor">
<td class="colFirst"><a href="../../../../../com/ibm/micro/client/mqttv3/MqttException.html" title="class in com.ibm.micro.client.mqttv3">MqttException</a></td>
<td class="colLast">
<div class="block">Thrown if an error occurs communicating with the server.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><a href="../../../../../com/ibm/micro/client/mqttv3/MqttPersistenceException.html" title="class in com.ibm.micro.client.mqttv3">MqttPersistenceException</a></td>
<td class="colLast">
<div class="block">This exception should be thrown by the implementor of the persistence
 interface if there is a problem reading or writing persistent data.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><a href="../../../../../com/ibm/micro/client/mqttv3/MqttSecurityException.html" title="class in com.ibm.micro.client.mqttv3">MqttSecurityException</a></td>
<td class="colLast">
<div class="block">Thrown when a client is not authorized to perform an operation, or
 if there is a problem with the security configuration.</div>
</td>
</tr>
</tbody>
</table>
</li>
</ul>
<a name="package_description">
<!--   -->
</a>
<h2 title="Package com.ibm.micro.client.mqttv3 Description">Package com.ibm.micro.client.mqttv3 Description</h2>
<div class="block">Contains a programming interface for communicating with an MQTT server using the MQTT V3 
protocol utilising the Eclipse MQTT client implementation.

<p>The MQTT API in this package was first made available with MQ v7.0. Since then
the underpinning implementation has been donated to open source by way of the 
Paho project in Eclipse. The implementation of this API is now a thin layer 
that maps to the Eclipse Paho MQTT implementation. The API in this package is best suited
to existing applications.  Applications that need to use new features should use
the Paho MQTT implementation found in package org.eclipse.paho.client.mqttv3.
</p>
<p>The Eclipse Paho implementation is a pre-requisite for this package and must 
be included on the classpath.
</p>
<p>
The MQ Telemetry Transport (MQTT) is a lightweight publish/subscribe protocol 
flowing over TCP/IP for remote sensors and control devices through low 
bandwidth communications. MQTT is used by specialized applications on 
small footprint devices that require a low bandwidth communication, 
typically for remote data acquisition and process control.
</p>
<p>
A typical system might comprise several hundred client devices communicating 
with a single server or "broker", where each client is identified 
by a unique ID. 
</p>
<p>The basic means of operating the client is as follows:</p>
<ol>
        <li>Create an instance of <a href="../../../../../com/ibm/micro/client/mqttv3/MqttClient.html" title="class in com.ibm.micro.client.mqttv3"><code>MqttClient</code></a>, providing
        the address of the server and a unique client identifier.</li>
        <li><a href="../../../../../com/ibm/micro/client/mqttv3/MqttClient.html#connect(com.ibm.micro.client.mqttv3.MqttConnectOptions)"><code>Connect</code></a> to the server</li>
        <li>Exchange messages with the server.
                <ul>
                        <li>Send <a href="../../../../../com/ibm/micro/client/mqttv3/MqttMessage.html" title="class in com.ibm.micro.client.mqttv3"><code>messages</code></a> to the server, 
                        via <a href="../../../../../com/ibm/micro/client/mqttv3/MqttTopic.html" title="class in com.ibm.micro.client.mqttv3"><code>topics</code></a>.</li>
                        <li>Receive messages from the server.  This is done asynchronously
                        using  
                        <a href="../../../../../com/ibm/micro/client/mqttv3/MqttClient.html#subscribe(java.lang.String, int)"><code>subscriptions</code></a>,
                        combined with a <a href="../../../../../com/ibm/micro/client/mqttv3/MqttClient.html#setCallback(com.ibm.micro.client.mqttv3.MqttCallback)"><code>callback</code></a>.
                        </li>
                </ul>
        </li>
<li><a href="../../../../../com/ibm/micro/client/mqttv3/MqttClient.html#disconnect()"><code>Disconnect</code></a> from the server.</li>
</ol>
</p>
<h3>Examples</h3>
<h4>Publish a message, at most once</h4>
<p>In the following code snippet, a simple message is published to the server,
using defaults wherever possible.</p>
<code><pre>     MqttClient client = new MqttClient("tcp://localhost:1883", "SampleClient");
        client.connect();
        MqttMessage message = new MqttMessage("Hello world");
        message.setQos(0);
        client.getTopic("foo/bar").publish(message);
        client.disconnect();</pre></code>

<p>This is the fastest way of publishing messages,
but is also the least reliable.  There is no assurance that the message will actually be
delivered, and no exception will be thrown if the server refuses the message, or if the
network connection fails.</p>

<h4>Publish a message, once and only once (single threaded)</h4>
<p>In the following code snippet, a message is published to the server
at QoS 2, which is the most reliable delivery mechanism.
In order to achieve this, the message needs to be persisted by the client.
A default implementation of persistence is provided by <a href="../../../../../com/ibm/micro/client/mqttv3/MqttDefaultFilePersistence.html" title="class in com.ibm.micro.client.mqttv3"><code>MqttDefaultFilePersistence</code></a>.
This will be used by the client unless an alternative is supplied.</p>
<p>Publishing reliably is more complex, and most of the code is used to handle
error conditions.  The key thing to notice is the two-stage delivery: the first
stage gives the message to the client.  After this, the client is responsible for
delivering the message to the server.  The second stage is about determining 
success or failure.</p>

<code><pre>
        MqttClient client = null;
        try {
                // Create a client to communicate with a broker at the specified address
                client = new MqttClient("tcp://localhost:1883", "SampleClient");
                // Connect to the broker
                client.connect();
        } catch (MqttException ex) {
                System.err.println("Could not connect");
        }
        
        if ((client != null) && client.isConnected()) {
                MqttTopic topic = client.getTopic("foo/bar");
                MqttDeliveryToken token = null;
                // Create message and set quality of service to deliver the message once
                MqttMessage message = new MqttMessage("Hello world");
                message.setQos(2);
                
                try {
                        // Give the message to the client for publishing.  For QoS 2,
                        // this will involve multiple network calls, which will happen 
                        // asynchronously after this method has returned.
                        token = topic.publish(message);
                }
                catch (MqttException ex) {
                        // Client has not accepted the message due to a failure
                        // Depending on the exception's reason code, we could always retry
                        System.err.println("Failed to send message");
                }
                
                if (token != null) {
                        boolean keepTrying = true;
                        do {
                                try {
                                        // Wait for the message delivery to complete
                                        token.waitForCompletion();
                                        System.out.println("Message delivery complete");
                                }
                                catch (MqttException deliveryException) {
                                        int reasonCode = deliveryException.getReasonCode();
                                        // TODO: Retry the message, or decide to stop trying
                                        System.err.println("Message delivery failed");
                                        if (client.isConnected() == false) {
                                                try {
                                                        // Re-connect to the server
                                                        client.connect();
                                                }
                                                catch (MqttException connectException) {
                                                        // Can't reconnect, so give up.  If and when the 
                                                        // client does reconnect, the message delivery
                                                        // will automatically continue
                                                        keepTrying = false;
                                                }
                                        }
                                }
                        } while (!token.isComplete() && keepTrying);
                }
        }</pre></code>
        
<h4>Publish a message, once and only once (multi-threaded)</h4>
<p>In the following code snippet, a message is published to the server
at QoS 2, which is the most reliable delivery mechanism.
The application uses a <a href="../../../../../com/ibm/micro/client/mqttv3/MqttCallback.html" title="interface in com.ibm.micro.client.mqttv3"><code>callback</code></a> to be notified 
when the delivery completes.</p>

<p>
A default implementation of persistence is provided by <a href="../../../../../com/ibm/micro/client/mqttv3/MqttDefaultFilePersistence.html" title="class in com.ibm.micro.client.mqttv3"><code>MqttDefaultFilePersistence</code></a>.
This will be used by the client unless an alternative is supplied.</p>

<code><pre>
public class SampleClient implements MqttCallback {
        public void run() {
                MqttClient client = null;
                try {
                        // Create a client to communicate with a broker at the specified address
                        client = new MqttClient("tcp://localhost:1883", "SampleClient");

                        // Connect to the broker
                        client.connect();

                        // Setup a callback
                        client.setCallback(this);

                } catch (MqttException ex) {
                        System.err.println("Could not connect");
                }
                
                if ((client != null) && client.isConnected()) {
                        MqttTopic topic = client.getTopic("foo/bar");
                        // Create message and set quality of service to deliver the message once
                        MqttMessage message = new MqttMessage("Hello world");
                        message.setQos(2);
        
                        try {
                                // Give the message to the client for publishing. For QoS 2, this
                                // will involve multiple network calls, which will happen
                                // asynchronously after this method has returned.
                                topic.publish(message);
                        } catch (MqttException ex) {
                                // Client has not accepted the message due to a failure
                                // Depending on the exception's reason code, we could always retry
                                System.err.println("Failed to send message");
                        }
                }
        }

        public void connectionLost(Throwable cause) {
                // TODO: Implement reconnection logic
                System.err.println("Connection lost");
        }

        public void deliveryComplete(MqttDeliveryToken token) {
                System.out.println("Delivery complete");
        }

        public void messageArrived(MqttTopic topic, MqttMessage message) throws Exception {
        }
}</pre></code>
<p>
Other programming languages,
<a href="/WebSocket/index.html"><big>Javascript</big></a>,
<a href="/clients/c/doc/html/index.html"><big>C</big></a>.</div>
</div>
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div role="navigation" title ="Bottom_NAVIGATION" aria-label ="Bottom Navigation Bar"/>
<div class="bottomNav"><a name="navbar_bottom">
<!--   -->
</a>
<div class="skip"><a href="#skip-navbar_bottom" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar_bottom_firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../overview-summary.html">Overview</a></li>
<li class="navBarCell1Rev">Package</li>
<li>Class</li>
<li><a href="package-use.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li>Prev Package</li>
<li><a href="../../../../../org/eclipse/paho/client/mqttv3/package-summary.html">Next Package</a></li>
</ul>
<ul class="navList">
<li><a href="../../../../../index.html?com/ibm/micro/client/mqttv3/package-summary.html" target="_top">Frames</a></li>
<li><a href="package-summary.html" target="_top">No Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../../../allclasses-noframe.html">All Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<a name="skip-navbar_bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
</body>
</html>
